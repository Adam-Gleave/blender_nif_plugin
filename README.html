<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>The Blender NIF Scripts v1.2 - README</title>


</head>


<body>

<h1>The Blender NIF Scripts v1.3 - README</h1>

<h2>Installation</h2>

<ul>

  <li><strong>Make sure you
have Blender 2.40</strong>; the scripts won't run on older
versions
of Blender.</li>

  <li><strong>The
scripts need a full Python 2.4 installation</strong>, as they use
regular
expressions and the 'struct' class. The
version of Python installed must be compatible with Blender, or
the scripts just won't run.&nbsp;At the time of writing this the
latest
'stable' version of Blender is Blender 2.40, and it was compiled with
bindings for Python 2.4.x. You won't need to uninstall Python 2.3 in
order to get the script running, but you need to install Python 2.4 as
well (you can get it from http://www.python.org/). Restart Blender and
everything should work fine. If
you still have problems, check out this LOOOONG thread on the elysiun
board: <a href="http://www.elysiun.com/forum/viewtopic.php?t=7723">http://www.elysiun.com/forum/viewtopic.php?t=7723</a>
The latest
pages will be the ones you will find more useful, as the thread started
several Blender versions back. </li>

  <li>Run the installer (recommended). If this does not work for
some reason, you can install the scripts
manually
from
the zip file:
    <ul>

      <li>Remove any old versions of the scripts (such as,
nif-export.py, nif_import_237.py, nif4_export.py, nif4_import_237.py,
nif4.py, nif4.pyc, ...).</li>

      <li>Copy
the export scripts "nif4_import_240.py" and
"nif_export.py", along with the
"niflib.py" and "_niflib.dll" files into the Blender scripts folder.
Under Windows this is by default Windows C:\Program Files\Blender
Foundation\Blender\.blender\scripts. Restart Blender,
and the options to import and export NIF files
will appear in the File-Import and File-Export menu's. </li>

    </ul>

  </li>

  <li>(optional) If you wish to use Morrowind's textures:
    <ul>

      <li>extract the contents of 'Morrowind.bsa' (and, if you
have the expansions, also 'Tribunal.bsa' and 'Bloodmoon.bsa') into
'C:\MORROWIND' </li>

      <li>convert all .dds files in 'C:\MORROWIND\textures' to
.tga files (for instance, using 'DDS Converter 2.1')</li>

    </ul>

  </li>

</ul>

<h2>Support</h2>

<ul>

  <li><a href="http://niftools.sourceforge.net/forum/">http://niftools.sourceforge.net/forum/</a></li>

  <li><a href="http://niftools.sourceforge.net/tutorial/blender/">http://niftools.sourceforge.net/tutorial/blender/</a></li>

</ul>

<h2>Release Notes</h2>

<ul>

  <li>The import &amp; export scripts have been updated for
Blender 2.40. You should remove any old versions of the scripts prior
to installing these scripts (the old files from the previous version
are nif4_export.py,
nif4_import_237.py, nif4.py, and nif4.pyc).</li>

  <li>Also, note that scripts under Blender 2.40 use Python 2.4;
if you don't have it installed, grab it from <a href="http://www.python.org">http://www.python.org</a>.
(Python 2.3 and 2.4 can live peacefully together.)</li>

  <li>The old exporter GUI has been dropped... in favor of
Blender's native Script Config GUI. To change the exporter settings, go
to the scripts window in Blender, and select
Scripts-&gt;System-&gt;Scripts Config Editor-&gt;Export. </li>

</ul>

<h3>Highlights of this Release</h3>

<ul>

  <li>Exporter support for embedded textures has been
reimplemented.</li>

  <li>Exporter &amp; importer support for vertex keys
(geometry morphing).</li>

  <li>Exporter should support NIF versions up to 10.0.1.0
(4.0.0.2, 4.1.0.12, 4.2.1.0,&nbsp;4.2.2.0, and 10.0.1.0), however, <em>THIS
HAS
NOT BEEN
TESTED EXTENSIVELY</em>; if you want, you can try to write a
4.2.2.0 NIF
file by setting "nif version" to 4.2.2.0 in the config editor (both
Civilization IV and Dark Age of Camelot support this version). Bug
reports regarding this new feature are highly appreciated!</li>

  <li>Various bugs have been fixed in the importer &amp; the
exporter. </li>

</ul>

<h3>In the background...</h3>

Support for NIF versions &gt; 10.0.1.0 is still going on. We've
almost completely decoded 20.0.0.4 (most NIF's in Civilization IV have
this format), and we're starting to figure out how animations work.
This is an on-going effort, and the NifTools devteam is
especially grateful to the Civ modding community for the enthusiastic
support we have recieved so far. Your patience will be rewarded!<br />

The importer is still being recoded to make use of Niflib,
so keep an eye out for updates. We're working on full skinning support
for the importer as well.
<h2>Exporter&nbsp;Notes</h2>

<p>Main author: Amorilia</p>

<h3>Thanks to...</h3>

<ul>

  <li>Brandano, for the import script, which helped a lot writing
this export script </li>

  <li>Taharez, for helping with the Python NIF library, and NIF
specs </li>

  <li>Brick, for NIF specs </li>

  <li>Shon, for Niflib, NIF specs, and explaining things
about&nbsp;skinning and programming </li>

  <li>y67_a, for pointing out the fact that the script forgot to
export normals; and thereby opening the path to smoothing support </li>

  <li>m4444x,&nbsp;for NifSkope, non-textured object support,
optimizing the
main loop in the trishapedata export, animation group support, vertex
color support, and texture flipping support </li>

</ul>

<h3>Usage </h3>

<ul>

  <li>create meshes (and empties, if you like) in blender:
    <ul>

      <li>IMPORTANT: if you wish to animate meshes without using
armatures and bones, then, when grouping, always make parent without
inverse (in
Object Mode, use CTRL-SHIFT-P) </li>

    </ul>

  </li>

  <li>create armatures and bones for animation
    <ul>

      <li>either edit bone envelopes, and parent your meshes to
armatures with vertex groups; the vertex weights will be constructed
using the bone envelopes</li>

      <li>or, simply parent meshes to bones (armature must be in
pose mode)</li>

      <li>insert pose mode keys in different frames (press I to
insert key, and select Rot, Loc, or LocRot) to compose your animation</li>

    </ul>

  </li>

  <li>create UV coordinates (be sure to check the blender manual
for more details)
    <ul>

      <li>create seams (3D View, Edit Mode, select seam vertices,
CTRL-E) </li>

      <li>in the 3D View, UV Face Select Mode, select all faces,
press U-&gt;LSCM </li>

      <li>(optional) if you want to create your own texture: in
the UV/Image Editor, UVs-&gt;Save UV Face Layout, and process the
saved texture with your favorite 2D paint program </li>

    </ul>

  </li>

  <li>add materials to your meshes, and add one texture to each
material, with the following settings:
    <ul>

      <li>texture map input: UV </li>

      <li>texture map output: COL for diffuse map (base texture) </li>

    </ul>

  </li>

  <li>for each texture:
    <ul>

      <li>set texture type to 'Image' </li>

      <li>either load a texture from 'C:\MORROWIND\textures', or
put your custom texture in the 'C:\Program Files\Morrowind\Data
Files\Textures' folder, and load it from there. Note that Blender does
not read .dds files.</li>

      <li>although this is not recommended, textures can be
embedded by toggling the "packed" button next to the "Reload" button in
the Image tab</li>

    </ul>

  </li>

  <li>(optional) animate meshes and/or empty objects (press I to
insert key, and select Rot, Loc, or LocRot; for now, only location and
rotation channels are exported); define the animation groups in a text
buffer called 'Anim' (check source code for an example; so far we only
support Morrowind-type animations) </li>

  <li>(optional) to export vertex colors, turn on the VCOL_PAINT
flag in the material tab </li>

  <li>(optional) Hull your model in a simple so-called collision
mesh, which defines where the player cannot walk through (most of
Morrowind's static models have a collision mesh, you can see them in
the TES CS pressing F4 in the render window). You may want to create it
to speed up collision detection, to help the player walk over objects
such as stairs, or to allow the player to walk through certain parts of
your model such as spider webs.
    <ul>

      <li>create a mesh called
'RootCollisionNode' (object name, not datablock name)</li>

      <li>don't apply any
material to it </li>

    </ul>

  </li>

  <li>(optional) if you suspect that some of the faces of your
meshes are not convex, then you should let blender triangulate these
meshes (press CTRL-T in edit mode with all vertices selected), because
in that case, Blender's triangulation algorithm is less error prone
than the triangulation algorithm used in this script. </li>

  <li><strong>select the models that you wish to export</strong>, and run this
script from the 'File-&gt;Export' menu. Note that the script looks
for unparented parents of the selected objects, and exports these root
objects along with all of their children, so you don't have to select
the whole model. </li>

</ul>

<h3>Limitations</h3>

<ul>

  <li>Particle effects, cameras, and lights are not exported.</li>

  <li>Actions (for animation groups) are ignored. Workaround:
define actions in text buffer called "Anim".</li>


</ul>

<h3>Known Issues </h3>

<ul>

  <li>Ambient and emit colors are obtained by multiplication with
the diffuse color.</li>

  <li>Blender double sided faces will be one sided in the NIF
file (workaround: duplicate faces).</li>

  <li>Export of directly animated&nbsp;meshes is buggy unless
you parent without parent inverse
(CTRL-SHIFT-P). Workaround: don't animate meshes directly; instead,
parent meshes to bones and animate the bones.</li>

  <li>Non-uniformly scaled objects cannot be exported.
Workaround: apply size and rotation. Unfortunately, this workaround
does not work on empties. </li>

</ul>

<h3>Old History</h3>

<p>(For recent history see the ChangeLog file)</p>

<ul>

  <li>0.0 (Jun 15): first try </li>

  <li>0.1 (Jun 20): fixed texture mapping, fixed transformations,
improved error handling </li>

  <li>0.2 (Jun 30): export animation, transparency, multiple
materials per mesh </li>

  <li>0.3 (Aug 25): export normals (fixes lighting, thx y67_a),
niflib.py updated </li>

  <li>0.4 (Aug 28): support smoothing </li>

  <li>0.5 (Sep 26): support for non-textured objects,
optimization in trishapedata </li>

  <li>0.6 (Sep 27): support for uniformly scaled objects (fixes
compatibility problem with Brandano's import script), fixed emissive
and ambient colour </li>

  <li>0.7 (Sep 30): animation group support (contributed by
m4444x) </li>

  <li>0.7.1 (Oct 4): vertex color support (contributed by m4444x)
  </li>

  <li>0.8 (Oct 12): code cleanup, moved to BSD license </li>

  <li>Newer versions: see ChangeLog file.</li>

</ul>

<h2>Importer Notes</h2>

<p>Main author: Alessandro Garosi (AKA Brandano)</p>

<h3>Credits</h3>

<ul>

  <li>Portions of this programs are (were) derived (through the
old tested method of cut'n paste) from the obj import script
obj_import.py: OBJ Import v0.9 by Campbell Barton (AKA Ideasman) (No
more. I rewrote the lot. Nevertheless I wouldn't have been able to
start this without Ideasman's script to read from!)</li>

  <li>Binary conversion functions are courtesy of SJH. Couldn't
find the full name, and couldn't find any license info, I got the code
for these from <a href="http://projects.blender.org/pipermail/bf-python/2004-July/001676.html">http://projects.blender.org/pipermail/bf-python/2004-July/001676.html</a></li>

  <li>The file reading strategy was 'inspired' by the NifToPoly
script included with the DAOC mapper, which used to be available at <a href="http://www.randomly.org/projects/mapper/">http://www.randomly.org/projects/mapper/</a>
and was written and is
copyright 2002 of Oliver Jowett. His domain and e-mail address are
however no longer reacheable. No part of the original code is included
here, as I pretty much rewrote everything, hence this is the only
mention of the original copyright. An updated version of the script is
included with the DAOC Mappergui application, available at <a href="http://nathrach.republicofnewhome.org/mappergui.html">http://nathrach.republicofnewhome.org/mappergui.html</a>
  </li>

</ul>

<h3>Thanks to...</h3>

<ul>

  <li>Campbell Barton (AKA Ideasman, Cambo) for making code clear
enough to be used as a learning resource. Hey, this is my first ever
python script!</li>

  <li>SJH for the binary conversion functions. Got the code off a
forum somewhere, posted by Ideasman, I suppose it's allright to use it</li>

  <li>Lars Rinde (AKA Taharez), for helping me a lot with the
file format, and with some debugging even though he doesn't 'do Python'</li>

  <li>Timothy Wakeham (AKA timmeh), for taking some of his time
to help me get to terms with the way the UV maps work in Blender</li>

  <li>Amorilia (don't know your name buddy), for bugfixes and
testing.<br />

  </li>

</ul>

<h3>Usage</h3>

<ul>

  <li>Launch the script, select the .NIF file you wish to import,
and you are
set.</li>

  <li>Actually, no, that's not it if you also want to load the
textures.
Blender does not support the loading of .DDS textures, so in order to
load these you must provide an alternative file with the same filename,
but with the extension .TGA, .PNG, .BMP or .JPG. Also, selecting a base
folder for the textures has proved to be an impossible task, so the
script looks for them in the same folder as the .NIF file, or in
"..\Textures\[subdir\]*.*" if the NIF file resides in
"..\Meshes\[subdir\]*.*". This means that if your NIF file is, say,
"C:\Morrowind\Data
Files\Meshes\deadparrot.nif" and the texture is "C:\Morrowind\Data
Files\Textures\parrot\dead.dds" you should convert the texture and move
it to "C:\Morrowind\Data Files\Meshes\Textures\parrot\dead.tga". This
is also in order to keep the texture file path consistent for the time
we'll be able to export the modified meshes from Blender.</li>

</ul>

<h3>
Limitations</h3>

<ul>

  <li>At the moment the script only loads the pure geometry data,
some
material info, and the first texture found on every mesh. This should
normally match the base texture, but the file format allows
for 'unordered' textures, so some models might import badly.</li>

  <li>Also, the script doesn't import animation, particle
effects, multiple
UV channels.... the list is too long. Working on it.</li>

  <li>The script loads the armature and vertex groups-weights of
the
skinned
meshes properly, but carences in Blender 2.37 armature python API do
not allow me to apply this skinnining info to the mesh from the script.
On top of that, bugs in the armature python API make it impossible to
save the armature as it is loaded in a .blend file. These matters are
being looked into by the Blender developers, and a
new armature system and API should be included with the next Blender
release.</li>

  <li>Meshes parented to bones are not properly imported.</li>

</ul>

<h3> Old History </h3>

<p> (For recent history see the ChangeLog file) </p>

<ul>

  <li>1.5a: fixed a bug where texture files with trailing null
characters would
crash the importer</li>

  <li>1.6a: changed the material handling, now doesn't generate
duplicate materials, changed the mesh creation method. Now it builds
hierarchical relations
generating empties as correspondences to NiNodes</li>

  <li>1.7a: got rid of a couple of matrix operations, now I apply
the transforms to
the mesh container rather than to the vertices, so there is no data
loss. The root node is scaled down to 1/10th of the original size and
rotated
-90# along the Z axis, but this is the only change introduced by the
importer. Now not only all the hierarchies are stored, but the empties
that act
as grouping widgets are moved to the correct relative coordinates, so
we might start to think about animations.</li>

  <li>1.8a: I did some little optimization, fixed a few things.
Now the root node is no longer rotated along the Z axis, as I realized
that I completely forgot that I should apply his transform matrix to
the root node as well. It is only scaled down to 10% of the original
size, and as all his
children inherit this transformation the meshes are much easier to
handle. I have also added a much better support for textures and
materials,
that are now only parsed once and reused if identical (obtained from
the same node). I couldn't notice any speed improvement, because on my
machine the
import is pretty much istantaneous anyway, but I believe that this
wastes less memory.</li>

  <li>1.9a: Not published, it didn't really introduce much change
to what was
already there.</li>

  <li>2.0a: Big things afoot, now I got bones! The script now
will load single or
multiple armatures, and build each armature's bone tree in the rest
position. The bone head position is correct, the tail is approximated
and the rotation is botched. The trouble is that Blender's bone API is
a little bit messy. Let's say very messy. The NIF bones store their
orientation and origin as a matrix relative
to the parent node, while in Blender all coordinates are relative to
the armature node. And on top of that while I have a getRestMatrix
method I don't have an equivalent setRestMatrix one. I am still working
on this, but I already have a couple of ideas on
what I can to to get these damn thing working properly. I still don't
have the skinning info, so moving the bones about won't
change the pose of the model. But if you want to help me out have a
look at the NiSkinInstance and NiSkinData nodes, NiSkinData in
particular. NiSkinInstance holds a list of bones that influence the
mesh, the class is already defined in the script, even though it isn't
used. In the smaller updates, if the script can't find a full Python
installation it will print a customized error showing the Python
version Blender was compiled with. This is not necessarily the Python
version you need, but is sure to work. At this time the correct version
is Python 2.3.5</li>

  <li>1.0.1: I took the occasion of a new Blender version out and
changed my
versioning convention. Sorry about the confusion. Fixed a bug that
would hang the script on Blender 2.37. Now bones are 'a' proper length
(NIF bone systems don't report a bone
length), and are aligned properly, well, within 1 degree of their roll
position</li>

  <li>1.0.2: A few (quite a few actually) bugfixes by Amorilia
(whoopee, another
python coder onboard!). Now the script won't crash with larger NIFs.
And read the right number
of blocks. And won't overwrite existing meshes etc.. </li>

  <li>1.0.3: Added a new way to roll bones to their proper
position, might save a
few cycles, tho sometimes it still needs to approximate the result.
Changed the way the nif format is detected. The script now also detects
the file version and can test against a list of different file
versions. It also allows for longer headers, like in the case of "Zoo
Thycoon 2"
NIF files. Zoo Thycoon 2 files are way too different from Morrowind's
files to be
imported, though.</li>

  <li>1.0.4: Removed a bunch of debug messages to speed up things
a little. Added vertex groups to the imported info, but the skinning
doesn't work
yet. To work properly both the meshes and the armature should share the
same coordinates system apparently, and the nested transformations that
are applied to both are making it very difficult to come up with a
working system. I really ran out of ideas, I am afraid. Meshes now are
imported as an "object" wrapped by a NiNode, and
therefore the outliner tree is a little simpler. This also loses a
little transform info, but nothing you will notice on the screen anyway
as the transform matrix of the NiNode and NiTriShape are combined while
importing.</li>

  <li>1.0.5: Fixed a few typos and a couple of mistakes that
Amorilia pointed out.
Still incomplete, by far, but seems to be approaching the "usable"
state.</li>

  <li>1.0.6: Added Amorilia's corrections to the import of UV
seams. Changed the
name of the file to reflect the fact that the importer is version
specific. As of this version the licensing is under a BSD license, to
avoid
confusion when distributing together with Amorilia's export script.
However, copyright on the two script is still with the respective
authors. Also, all previous versions of this script are still to be
considered
as governed by the GPL license. I also removed a small portion of the
readme regarding python setup, as
it was confusing, redundant and most likely just wrong. For the moment
I'll rely on the Blender's user forums, until I can come up with a
decent tutorial on setting up python properly.</li>

</ul>

<h2>License </h2>

<p> Copyright (c) 2005, <a href="http://niftools.sourceforge.net/">NIF File Format
Library and Tools</a><br />

All rights reserved. </p>

<p> Redistribution and use in source and binary forms, with or
without modification, are permitted provided that the following
conditions are met: </p>

<ul>

  <li>Redistributions of source code must retain the above
copyright notice, this list of conditions and the following disclaimer.
  </li>

  <li>Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution. </li>

  <li>Neither the name of the NIF File Format Library and Tools
project nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior
written permission. </li>

</ul>

<p> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS
OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE. </p>

</body>
</html>
